# åœ–é¢è­˜åˆ¥æ•™å­¸ RAG ç³»çµ±

## ğŸ“– å°ˆæ¡ˆæ¦‚è¿°

é€™æ˜¯ä¸€å€‹å°ˆç‚ºå“ç®¡æ•™è‚²è¨“ç·´è¨­è¨ˆçš„æ™ºèƒ½å•ç­”ç³»çµ±ï¼Œèƒ½å¤ è™•ç†åŒ…å«æŠ€è¡“åœ–é¢çš„PDFæ•™æï¼Œä¸¦æä¾›åŸºæ–¼RAG (Retrieval-Augmented Generation) çš„æ™ºèƒ½å•ç­”æœå‹™ã€‚ç³»çµ±æ”¯æ´è¦–è¦ºåˆ†æï¼Œèƒ½å¤ ç†è§£å’Œè§£é‡‹æŠ€è¡“åœ–é¢ä¸­çš„ç¬¦è™Ÿã€æ¨™è¨˜å’Œå…§å®¹ã€‚

## ğŸš€ ä¸»è¦åŠŸèƒ½

- **ğŸ“„ PDFæ™ºèƒ½è™•ç†**: è‡ªå‹•æå–æ–‡å­—å…§å®¹å’Œåœ–ç‰‡ï¼Œæ”¯æ´ä¸Šå‚³è™•ç†
- **ğŸ” è¦–è¦ºåˆ†æ**: ä½¿ç”¨GPT-4oåˆ†ææŠ€è¡“åœ–é¢å’Œç¬¦è™Ÿ
- **ğŸ§  æ™ºèƒ½åˆ†é¡**: è‡ªå‹•è­˜åˆ¥ä¸»é¡Œã€å…§å®¹é¡å‹å’Œé›£åº¦ç­‰ç´š
- **ğŸ” å‘é‡æª¢ç´¢**: åŸºæ–¼Qdrantå‘é‡è³‡æ–™åº«çš„èªç¾©æœå°‹
- **ğŸ’¬ å¤šæ¨¡æ…‹å•ç­”**: çµåˆæ–‡å­—å’Œåœ–ç‰‡çš„æ™ºèƒ½å›ç­”
- **ğŸ§  è¨˜æ†¶åŠŸèƒ½**: æ”¯æ´å¤šæœƒè©±è¨˜æ†¶ç®¡ç†å’Œä¸Šä¸‹æ–‡å°è©±
- **ğŸŒ APIæœå‹™**: æä¾›å®Œæ•´çš„RESTful API
- **ğŸ”— Flowiseæ•´åˆ**: å°ˆç‚ºFlowiseèŠå¤©æ©Ÿå™¨äººå¹³å°è¨­è¨ˆçš„API

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
PDFæ–‡ä»¶ â†’ PDFè™•ç†å™¨ â†’ å…§å®¹åˆ†æ â†’ å‘é‡åµŒå…¥ â†’ Qdrantè³‡æ–™åº« â†’ APIæœå‹™ â†’ æ™ºèƒ½å•ç­”
    â†“         â†“         â†“         â†“          â†“         â†“
  åœ–ç‰‡æå–  è¦–è¦ºåˆ†æ  çµæ§‹åŒ–æ®µè½  1536ç¶­å‘é‡  èªç¾©æœå°‹  å¤šæ¨¡æ…‹å›æ‡‰
```

## ï¿½ å®Œæ•´è³‡æ–™æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PDFæ–‡ä»¶ä¸Šå‚³    â”‚â”€â”€â”€â–¶â”‚   PDFè™•ç†å™¨      â”‚â”€â”€â”€â–¶â”‚   å…§å®¹åˆ†æ       â”‚
â”‚  /process-pdf   â”‚    â”‚  pdfplumber     â”‚    â”‚  ä¸»é¡Œåˆ†é¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  PyMuPDF        â”‚    â”‚  é—œéµå­—æå–     â”‚
                       â”‚  GPT-4oè¦–è¦º     â”‚    â”‚  é›£åº¦åˆ¤æ–·       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åœ–ç‰‡å„²å­˜       â”‚    â”‚   å‘é‡åŒ–è™•ç†     â”‚    â”‚  DocumentChunk  â”‚
â”‚  AWS S3é›²ç«¯     â”‚    â”‚  OpenAI         â”‚    â”‚  çµæ§‹åŒ–ç‰©ä»¶     â”‚
â”‚  æœ¬åœ°images/    â”‚    â”‚  Embeddings     â”‚    â”‚  JSONLæ ¼å¼      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APIæœå‹™       â”‚â—€â”€â”€â”€â”‚   Qdrantå‘é‡åº«   â”‚â—€â”€â”€â”€â”‚   å‘é‡å„²å­˜       â”‚
â”‚  FastAPI        â”‚    â”‚  èªç¾©æœå°‹       â”‚    â”‚  1536ç¶­å‘é‡     â”‚
â”‚  Port 8006      â”‚    â”‚  ç›¸ä¼¼åº¦è¨ˆç®—     â”‚    â”‚  Metadata       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ¶æŸ¥è©¢       â”‚    â”‚   è¨˜æ†¶ç®¡ç†       â”‚    â”‚   æ™ºèƒ½å›æ‡‰       â”‚
â”‚  /query         â”‚    â”‚  æœƒè©±è¨˜æ†¶       â”‚    â”‚  RAGç”Ÿæˆ        â”‚
â”‚  /chat          â”‚    â”‚  ä¸Šä¸‹æ–‡è¿½è¹¤     â”‚    â”‚  åœ–ç‰‡URL        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ï¿½ğŸ“Š è³‡æ–™æµç¨‹

### 1. PDFè™•ç†éšæ®µ
- **æ–‡å­—æå–**: ä½¿ç”¨ `pdfplumber` æå–æ¯é æ–‡å­—å…§å®¹
- **åœ–ç‰‡æª¢æ¸¬**: ä½¿ç”¨ `PyMuPDF` æª¢æ¸¬ä¸¦æå–é é¢åœ–ç‰‡
- **è¦–è¦ºåˆ†æ**: ä½¿ç”¨ `GPT-4o` åˆ†ææŠ€è¡“åœ–é¢å’Œç¬¦è™Ÿ
- **æ–‡ä»¶ä¸Šå‚³**: æ”¯æ´é€éAPIä¸Šå‚³PDFæ–‡ä»¶é€²è¡Œå³æ™‚è™•ç†

### 2. å…§å®¹åˆ†æéšæ®µ
- **ä¸»é¡Œè­˜åˆ¥**: é›¶ä»¶åœ–ã€æˆå“åœ–ã€åœ–é¢ç¬¦è™Ÿã€ç·šä½åœ–ã€åœ–é¢æœ‰æ•ˆæ€§ã€å…¬å·®æ¨™æº–
- **å…§å®¹åˆ†é¡**: å®šç¾©ã€ç¨‹åºã€ç¬¦è™Ÿã€ç¯„ä¾‹ã€è¡¨æ ¼
- **é—œéµå­—æå–**: æŠ€è¡“è¡“èªã€ç¬¦è™Ÿã€ç¸®å¯«
- **é›£åº¦åˆ¤æ–·**: åŸºç¤ã€ä¸­ç´šã€é€²éš
- **çµæ§‹åŒ–å„²å­˜**: ç”ŸæˆDocumentChunkç‰©ä»¶ä¸¦å„²å­˜ç‚ºJSONLæ ¼å¼

### 3. å‘é‡åŒ–éšæ®µ
- **åµŒå…¥æ¨¡å‹**: `text-embedding-3-small` (1536ç¶­)
- **å‘é‡è³‡æ–™åº«**: Qdrant (Cosineç›¸ä¼¼åº¦)
- **éšå±¤å¼metadata**: æ–‡ä»¶çµæ§‹ã€ä¸»é¡Œåˆ†é¡ã€å…§å®¹ç‰¹å¾µã€åœ–ç‰‡è³‡è¨Š
- **é›†åˆç®¡ç†**: æ”¯æ´å¤šå€‹å‘é‡é›†åˆçš„å»ºç«‹å’Œç®¡ç†

### 4. APIæœå‹™éšæ®µ
- **FastAPIä¼ºæœå™¨**: æä¾›å®Œæ•´çš„RESTful API (Port 8006)
- **Flowiseæ•´åˆ**: å°ˆç”¨çš„/queryç«¯é»æ”¯æ´èŠå¤©æ©Ÿå™¨äººå¹³å°
- **è¨˜æ†¶ç®¡ç†**: å¤šæœƒè©±è¨˜æ†¶åŠŸèƒ½ï¼Œæ”¯æ´ä¸Šä¸‹æ–‡å°è©±
- **åœ–ç‰‡æœå‹™**: AWS S3é›²ç«¯åœ–ç‰‡URLç”Ÿæˆ
- **å¥åº·æª¢æŸ¥**: ç³»çµ±ç‹€æ…‹ç›£æ§å’Œè¨ºæ–·

## ğŸ› ï¸ æŠ€è¡“æ£§

### æ ¸å¿ƒæŠ€è¡“
- **Python 3.8+**: ä¸»è¦é–‹ç™¼èªè¨€
- **FastAPI**: Web APIæ¡†æ¶
- **Qdrant**: å‘é‡è³‡æ–™åº«
- **OpenAI GPT-4o**: è¦–è¦ºåˆ†æå’Œå›ç­”ç”Ÿæˆ
- **OpenAI Embeddings**: æ–‡å­—å‘é‡åŒ–

### ä¸»è¦ä¾è³´
```
fastapi>=0.104.1
qdrant-client>=1.6.4
openai>=1.3.0
pdfplumber>=0.9.0
PyMuPDF>=1.23.0
PyPDF2>=3.0.1
numpy>=1.24.0
scipy>=1.11.0
python-dotenv>=1.0.0
uvicorn>=0.24.0
```

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
ä»Šçš“å°ˆå®¶RAG(é‘‘è­˜åœ–ç‰‡PPT)/
â”œâ”€â”€ main.py                 # FastAPIä¸»æ‡‰ç”¨ç¨‹å¼
â”œâ”€â”€ pdf_processor.py        # PDFè™•ç†å™¨
â”œâ”€â”€ rag_system.py          # RAGç³»çµ±æ ¸å¿ƒ
â”œâ”€â”€ config.py              # ç³»çµ±é…ç½®
â”œâ”€â”€ meteor_utilities.py    # å‘é‡åŒ–å·¥å…·
â”œâ”€â”€ requirements.txt       # ä¾è³´å¥—ä»¶
â”œâ”€â”€ processed_chunks.jsonl # è™•ç†å¾Œçš„æ–‡ä»¶æ®µè½
â”œâ”€â”€ images/                # æå–çš„åœ–ç‰‡ç›®éŒ„
â”‚   â”œâ”€â”€ åœ–é¢è­˜åˆ¥æ•™æ_PDF_page_1.png
â”‚   â”œâ”€â”€ åœ–é¢è­˜åˆ¥æ•™æ_PDF_page_11.png
â”‚   â””â”€â”€ åœ–é¢è­˜åˆ¥æ•™æ_PDF_page_13.png
â””â”€â”€ README.md             # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
```

## âš™ï¸ å®‰è£èˆ‡è¨­å®š

### 1. ç’°å¢ƒæº–å‚™
```bash
# å…‹éš†å°ˆæ¡ˆ
git clone <repository-url>
cd ä»Šçš“å°ˆå®¶RAG(é‘‘è­˜åœ–ç‰‡PPT)

# å®‰è£ä¾è³´
pip install -r requirements.txt
```

### 2. ç’°å¢ƒè®Šæ•¸è¨­å®š
å‰µå»º `.env` æ–‡ä»¶ï¼š
```env
# OpenAI APIè¨­å®š
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# Qdrantè¨­å®š
QDRANT_URL=http://ec2-13-112-118-36.ap-northeast-1.compute.amazonaws.com:6333
QDRANT_COLLECTION_NAME=your_collection_name_here

# APIè¨­å®š
MAX_TOKENS=1000
TEMPERATURE=0.7
TOP_K_RETRIEVAL=3
```

### 3. è³‡æ–™æº–å‚™
```bash
# æ³¨æ„ï¼šæœ¬å°ˆæ¡ˆä½¿ç”¨æ‰‹å‹•åŒ¯å…¥çš„ Qdrant çŸ¥è­˜åº«
# ç¢ºä¿æ‚¨çš„ Qdrant é›†åˆä¸­å·²æœ‰è³‡æ–™

# å•Ÿå‹•APIæœå‹™
uv run main.py
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. å•Ÿå‹•æœå‹™
```bash
uv run main.py
```
æœå‹™å°‡åœ¨ `http://localhost:8006` å•Ÿå‹•

### 2. APIç«¯é»ç¸½è¦½

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªªæ˜ |
|------|------|------|------|
| `/` | GET | æ ¹è·¯å¾‘ | APIåŸºæœ¬è³‡è¨Š |
| `/health` | GET | å¥åº·æª¢æŸ¥ | ç³»çµ±ç‹€æ…‹ç›£æ§ |
| `/query` | POST | FlowiseæŸ¥è©¢ | å°ˆç‚ºFlowiseè¨­è¨ˆçš„å•ç­”APIï¼ˆç„¡è¨˜æ†¶ï¼‰ |
| `/query-with-memory` | POST | Flowiseè¨˜æ†¶æŸ¥è©¢ | Flowiseæ ¼å¼ä½†æ”¯æ´æœƒè©±è¨˜æ†¶çš„API |
| `/chat` | POST | è¨˜æ†¶èŠå¤© | æ”¯æ´æœƒè©±è¨˜æ†¶çš„èŠå¤©API |
| `/process-pdf` | POST | PDFè™•ç† | ä¸Šå‚³ä¸¦è™•ç†PDFæ–‡ä»¶ |
| `/collections` | GET | åˆ—å‡ºé›†åˆ | ç²å–æ‰€æœ‰Qdranté›†åˆ |
| `/collections/{name}` | DELETE | åˆªé™¤é›†åˆ | åˆªé™¤æŒ‡å®šçš„å‘é‡é›†åˆ |
| `/sessions` | GET | åˆ—å‡ºæœƒè©± | ç²å–æ‰€æœ‰èŠå¤©æœƒè©±ID |
| `/sessions/{id}` | GET | æœƒè©±è³‡è¨Š | ç²å–æŒ‡å®šæœƒè©±çš„è©³ç´°è³‡è¨Š |
| `/sessions/{id}` | DELETE | æ¸…é™¤æœƒè©± | æ¸…é™¤æŒ‡å®šæœƒè©±çš„è¨˜æ†¶ |
| `/images/{filename}` | GET | éœæ…‹åœ–ç‰‡ | æä¾›æœ¬åœ°åœ–ç‰‡æª”æ¡ˆ |

### 3. è©³ç´°APIèªªæ˜

#### ğŸ  æ ¹è·¯å¾‘
```bash
GET /
```
**å›æ‡‰**: APIåŸºæœ¬è³‡è¨Šå’Œå°èˆªé€£çµ

#### ğŸ” å¥åº·æª¢æŸ¥
```bash
GET /health
```
**å›æ‡‰**: ç³»çµ±ç‹€æ…‹ã€Qdranté€£ç·šã€æ–‡ä»¶æ®µè½æ•¸ã€åœ–ç‰‡æ•¸é‡

#### ğŸ¤– Flowiseæ•´åˆæŸ¥è©¢
```bash
POST /query
Content-Type: application/json

{
    "question": "Î¦ç¬¦è™Ÿä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ",
    "chatId": "chat_123"
}
```
**åŠŸèƒ½**: å°ˆç‚ºFlowiseèŠå¤©æ©Ÿå™¨äººå¹³å°è¨­è¨ˆï¼Œæ”¯æ´åœ–ç‰‡URLå›å‚³ï¼ˆç„¡æœƒè©±è¨˜æ†¶ï¼‰

#### ğŸ§  Flowiseè¨˜æ†¶æŸ¥è©¢
```bash
POST /query-with-memory
Content-Type: application/json

{
    "question": "ä½ é‚„è¨˜å¾—æˆ‘å‰›æ‰å•çš„å•é¡Œå—ï¼Ÿ",
    "chatId": "chat_123"
}
```
**åŠŸèƒ½**: ä½¿ç”¨Flowiseæ ¼å¼ä½†æ”¯æ´æœƒè©±è¨˜æ†¶åŠŸèƒ½ï¼ŒchatIdæœƒä½œç‚ºsession_idä½¿ç”¨

#### ğŸ’¬ è¨˜æ†¶èŠå¤©
```bash
POST /chat
Content-Type: application/json

{
    "message": "ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜",
    "session_id": "optional_session_id",
    "use_rag": true,
    "top_k": 3
}
```
**åŠŸèƒ½**: æ”¯æ´æœƒè©±è¨˜æ†¶çš„æ™ºèƒ½èŠå¤©ï¼Œå¯é¸æ“‡æ˜¯å¦ä½¿ç”¨RAGæª¢ç´¢

#### ğŸ“„ PDFæ–‡ä»¶è™•ç†
```bash
POST /process-pdf
Content-Type: multipart/form-data

Parameters:
- file: PDFæ–‡ä»¶ (å¿…å¡«)
- collection_name: è‡ªå®šç¾©é›†åˆåç¨± (å¯é¸)
- enable_vision: æ˜¯å¦å•Ÿç”¨è¦–è¦ºåˆ†æ (é è¨­: true)
- force_recreate: æ˜¯å¦å¼·åˆ¶é‡æ–°å‰µå»ºé›†åˆ (é è¨­: false)
```
**åŠŸèƒ½**: ä¸Šå‚³PDFæ–‡ä»¶ä¸¦è‡ªå‹•è™•ç†ã€å‘é‡åŒ–ã€å„²å­˜åˆ°Qdrant

#### ğŸ—‚ï¸ é›†åˆç®¡ç†
```bash
# ç²å–æ‰€æœ‰é›†åˆ
GET /collections

# åˆªé™¤æŒ‡å®šé›†åˆ
DELETE /collections/{collection_name}
```
**åŠŸèƒ½**: ç®¡ç†Qdrantå‘é‡è³‡æ–™åº«ä¸­çš„é›†åˆ

#### ğŸ§  æœƒè©±è¨˜æ†¶ç®¡ç†
```bash
# ç²å–æ‰€æœ‰æœƒè©±
GET /sessions

# ç²å–æœƒè©±è³‡è¨Š
GET /sessions/{session_id}

# æ¸…é™¤æœƒè©±è¨˜æ†¶
DELETE /sessions/{session_id}
```
**åŠŸèƒ½**: ç®¡ç†èŠå¤©æœƒè©±çš„è¨˜æ†¶å’Œä¸Šä¸‹æ–‡

### 4. ä½¿ç”¨ç¯„ä¾‹

#### ğŸ” å¥åº·æª¢æŸ¥ç¯„ä¾‹
```bash
curl -X GET "http://localhost:8006/health"
```

#### ğŸ¤– FlowiseæŸ¥è©¢ç¯„ä¾‹
```bash
curl -X POST "http://localhost:8006/query" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ä»€éº¼æ˜¯æœ‰æ•ˆåœ–é¢ï¼Ÿ",
    "chatId": "chat_123"
  }'
```

#### ğŸ§  Flowiseè¨˜æ†¶æŸ¥è©¢ç¯„ä¾‹
```bash
# ç¬¬ä¸€æ¬¡å°è©±
curl -X POST "http://localhost:8006/query-with-memory" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜",
    "chatId": "chat_123"
  }'

# ç¬¬äºŒæ¬¡å°è©±ï¼ˆæœƒè¨˜ä½ä¹‹å‰çš„å…§å®¹ï¼‰
curl -X POST "http://localhost:8006/query-with-memory" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "ä½ é‚„è¨˜å¾—æˆ‘çš„åå­—å—ï¼Ÿ",
    "chatId": "chat_123"
  }'
```

#### ğŸ’¬ è¨˜æ†¶èŠå¤©ç¯„ä¾‹
```bash
curl -X POST "http://localhost:8006/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜",
    "use_rag": true,
    "top_k": 3
  }'
```

#### ğŸ“„ PDFæ–‡ä»¶è™•ç†ç¯„ä¾‹
```bash
# ä½¿ç”¨curlä¸Šå‚³PDFæ–‡ä»¶
curl -X POST "http://localhost:8006/process-pdf" \
  -F "file=@your_document.pdf" \
  -F "collection_name=my_custom_collection" \
  -F "enable_vision=true" \
  -F "force_recreate=false"
```

#### ğŸ—‚ï¸ é›†åˆç®¡ç†ç¯„ä¾‹
```bash
# ç²å–æ‰€æœ‰é›†åˆ
curl -X GET "http://localhost:8006/collections"

# åˆªé™¤é›†åˆ
curl -X DELETE "http://localhost:8006/collections/my_collection"
```

#### ğŸ§  æœƒè©±ç®¡ç†ç¯„ä¾‹
```bash
# ç²å–æ‰€æœ‰æœƒè©±
curl -X GET "http://localhost:8006/sessions"

# ç²å–æœƒè©±è³‡è¨Š
curl -X GET "http://localhost:8006/sessions/session_123"

# æ¸…é™¤æœƒè©±è¨˜æ†¶
curl -X DELETE "http://localhost:8006/sessions/session_123"
```

#### ğŸ Python SDKç¯„ä¾‹
```python
import requests

class RAGClient:
    def __init__(self, base_url="http://localhost:8006"):
        self.base_url = base_url

    def health_check(self):
        """å¥åº·æª¢æŸ¥"""
        response = requests.get(f"{self.base_url}/health")
        return response.json()

    def query_flowise(self, question, chat_id):
        """FlowiseæŸ¥è©¢ï¼ˆç„¡è¨˜æ†¶ï¼‰"""
        data = {"question": question, "chatId": chat_id}
        response = requests.post(f"{self.base_url}/query", json=data)
        return response.json()

    def query_flowise_with_memory(self, question, chat_id):
        """Flowiseæ ¼å¼çš„è¨˜æ†¶æŸ¥è©¢"""
        data = {"question": question, "chatId": chat_id}
        response = requests.post(f"{self.base_url}/query-with-memory", json=data)
        return response.json()

    def chat_with_memory(self, message, session_id=None, use_rag=True, top_k=3):
        """è¨˜æ†¶èŠå¤©"""
        data = {
            "message": message,
            "session_id": session_id,
            "use_rag": use_rag,
            "top_k": top_k
        }
        response = requests.post(f"{self.base_url}/chat", json=data)
        return response.json()

    def process_pdf(self, file_path, collection_name=None, enable_vision=True):
        """è™•ç†PDFæ–‡ä»¶"""
        with open(file_path, "rb") as f:
            files = {"file": f}
            data = {
                "collection_name": collection_name,
                "enable_vision": enable_vision,
                "force_recreate": False
            }
            response = requests.post(
                f"{self.base_url}/process-pdf",
                files=files,
                data=data
            )
            return response.json()

# ä½¿ç”¨ç¯„ä¾‹
client = RAGClient()

# å¥åº·æª¢æŸ¥
health = client.health_check()
print(f"ç³»çµ±ç‹€æ…‹: {health['status']}")

# ä½¿ç”¨Flowiseæ ¼å¼çš„è¨˜æ†¶å°è©±
chat_id = "user_123"
result1 = client.query_flowise_with_memory("ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜", chat_id)
print(f"AIå›æ‡‰: {result1['text']}")

result2 = client.query_flowise_with_memory("ä½ é‚„è¨˜å¾—æˆ‘çš„åå­—å—ï¼Ÿ", chat_id)
print(f"AIå›æ‡‰: {result2['text']}")

# æˆ–ä½¿ç”¨åŸå§‹çš„è¨˜æ†¶èŠå¤©æ ¼å¼
session_id = None
result3 = client.chat_with_memory("ä½ å¥½ï¼Œæˆ‘æ˜¯å°ç‹")
session_id = result3["session_id"]

result4 = client.chat_with_memory("ä½ é‚„è¨˜å¾—æˆ‘çš„åå­—å—ï¼Ÿ", session_id)
print(f"AIå›æ‡‰: {result4['response']}")
```

### 5. APIå›æ‡‰æ ¼å¼

#### ğŸ  æ ¹è·¯å¾‘å›æ‡‰
```json
{
    "message": "åœ–é¢è­˜åˆ¥æ•™å­¸ RAG API",
    "version": "1.0.0",
    "docs": "/docs",
    "health": "/health"
}
```

#### ğŸ” å¥åº·æª¢æŸ¥å›æ‡‰
```json
{
    "status": "healthy",
    "qdrant_connected": true,
    "chunks_loaded": 15,
    "images_available": 3
}
```

#### ğŸ¤– FlowiseæŸ¥è©¢å›æ‡‰
```json
{
    "text": "æœ‰æ•ˆåœ–é¢æ˜¯æŒ‡ç¶“å·¥ç¨‹éƒ¨æ­£å¼ç™¼è¡Œçš„é›¶ä»¶åœ–ï¼Œé ˆè“‹æœ‰æª¢é©—ç« ã€æª¢é©—å·¥å…·ç« ã€å…¬å·®ç« ã€å·¥ç¨‹éƒ¨ä¸»ç®¡å¯©æ ¸ç« åŠç™¼è¡Œç‰ˆæœ¬ã€å·¥ç¨‹éƒ¨ç™¼è¡Œç« ã€‚\n\nğŸ“· ç›¸é—œåœ–ç‰‡ï¼š\n1. https://jh-expert-agent.s3.ap-northeast-1.amazonaws.com/åœ–é¢è­˜åˆ¥æ•™æ_PDF_page_1.png",
    "question": "ä»€éº¼æ˜¯æœ‰æ•ˆåœ–é¢ï¼Ÿ",
    "chatId": "chat_123",
    "sessionId": "session_chat_123_1720012345",
    "chatMessageId": "uuid-generated-id"
}
```

#### ğŸ’¬ è¨˜æ†¶èŠå¤©å›æ‡‰
```json
{
    "response": "ä½ å¥½å°æ˜ï¼å¾ˆé«˜èˆˆèªè­˜ä½ ã€‚æˆ‘æ˜¯å°ˆæ¥­çš„å“ç®¡æ•™è‚²è¨“ç·´è¬›å¸«åŠ©æ‰‹ï¼Œå¯ä»¥å¹«ä½ å­¸ç¿’åœ–é¢è­˜åˆ¥ç›¸é—œçŸ¥è­˜ã€‚",
    "session_id": "abc123-def456-ghi789",
    "message_count": 2,
    "total_tokens": 156,
    "sources": [],
    "rag_used": false
}
```

#### ğŸ“„ PDFè™•ç†å›æ‡‰
```json
{
    "success": true,
    "message": "æˆåŠŸè™•ç†PDFæ–‡ä»¶ 'technical_manual.pdf'",
    "chunks_processed": 25,
    "images_extracted": 8,
    "collection_name": "my_custom_collection",
    "processing_time": 45.67,
    "errors": []
}
```

#### ğŸ—‚ï¸ é›†åˆåˆ—è¡¨å›æ‡‰
```json
[
    "steven_test_0703",
    "my_custom_collection",
    "another_collection"
]
```

#### ğŸ§  æœƒè©±è³‡è¨Šå›æ‡‰
```json
{
    "session_id": "abc123-def456-ghi789",
    "exists": true,
    "message_count": 5,
    "total_tokens": 1250,
    "last_activity": 1720012345.67
}
```

## ğŸ“ˆ ç³»çµ±ç‰¹è‰²

### 1. å¤šæ¨¡æ…‹è™•ç†
- **æ–‡å­—ç†è§£**: ç²¾ç¢ºæå–å’Œåˆ†ææŠ€è¡“æ–‡ä»¶å…§å®¹
- **åœ–ç‰‡åˆ†æ**: GPT-4oè¦–è¦ºåˆ†ææŠ€è¡“åœ–é¢
- **ç¬¦è™Ÿè­˜åˆ¥**: è‡ªå‹•è­˜åˆ¥Î¦ã€å…¬å·®ã€å°ºå¯¸ç­‰æŠ€è¡“ç¬¦è™Ÿ

### 2. æ™ºèƒ½åˆ†é¡
- **ä¸»é¡Œåˆ†é¡**: 6å¤§ä¸»é¡Œè‡ªå‹•åˆ†é¡
- **å…§å®¹é¡å‹**: 5ç¨®å…§å®¹é¡å‹è­˜åˆ¥
- **é›£åº¦ç­‰ç´š**: 3ç´šé›£åº¦è‡ªå‹•åˆ¤æ–·

### 3. é«˜æ•ˆæª¢ç´¢
- **èªç¾©æœå°‹**: åŸºæ–¼å‘é‡ç›¸ä¼¼åº¦çš„ç²¾ç¢ºæª¢ç´¢
- **éšå±¤å¼metadata**: è±å¯Œçš„çµæ§‹åŒ–è³‡è¨Š
- **ç›¸é—œæ€§è§£é‡‹**: è‡ªå‹•è§£é‡‹æª¢ç´¢çµæœçš„ç›¸é—œæ€§

### 4. ä¼æ¥­ç´šéƒ¨ç½²
- **é›²ç«¯æ•´åˆ**: AWS S3åœ–ç‰‡æœå‹™
- **APIæ¨™æº–**: RESTful APIè¨­è¨ˆ
- **ç›£æ§åŠŸèƒ½**: å¥åº·æª¢æŸ¥å’Œç³»çµ±çµ±è¨ˆ
- **æ“´å±•æ€§**: æ”¯æ´Flowiseç­‰ç¬¬ä¸‰æ–¹å¹³å°

## ğŸ”§ é…ç½®èªªæ˜

### ä¸»é¡Œåˆ†é¡é…ç½®
```python
TOPIC_CATEGORIES = {
    "é›¶ä»¶åœ–": ["é›¶ä»¶åœ–", "é›¶ä»¶", "ä¾›æ‡‰å•†", "IQC"],
    "æˆå“åœ–": ["æˆå“åœ–", "æˆå“", "çµ„è£", "BOM"],
    "åœ–é¢ç¬¦è™Ÿ": ["ç¬¦è™Ÿ", "Î¦", "ç›´å¾‘", "åšåº¦", "å…¬å·®", "å–®ä½"],
    "ç·šä½åœ–": ["ç·šä½åœ–", "PIN", "é€£æ¥å™¨", "é›»è·¯"],
    "åœ–é¢æœ‰æ•ˆæ€§": ["æœ‰æ•ˆåœ–é¢", "æª¢é©—ç« ", "å¯©æ ¸ç« ", "ç™¼è¡Œç‰ˆæœ¬"],
    "å…¬å·®æ¨™æº–": ["å…¬å·®", "Max", "Min", "æ¨™æº–", "è¦æ ¼"]
}
```

### æ•™å­¸æ¨¡å¼é…ç½®
- **qa**: å•ç­”æ¨¡å¼ - å›ç­”å…·é«”å•é¡Œ
- **quiz**: æ¸¬é©—æ¨¡å¼ - ç”Ÿæˆæ¸¬é©—é¡Œç›®  
- **guide**: å°è®€æ¨¡å¼ - ç« ç¯€é‡é»èªªæ˜
- **search**: æœå°‹æ¨¡å¼ - é—œéµå­—æŸ¥è©¢
- **explain**: è§£é‡‹æ¨¡å¼ - æ·±åº¦èªªæ˜æ¦‚å¿µ

## ğŸ“Š ç³»çµ±çµ±è¨ˆ

ç›®å‰ç³»çµ±åŒ…å«ï¼š
- **15å€‹æ–‡ä»¶æ®µè½**: ä¾†è‡ªPDFçš„çµæ§‹åŒ–å…§å®¹
- **3å¼µåœ–ç‰‡**: æå–çš„æŠ€è¡“åœ–é¢
- **6å€‹ä¸»é¡Œåˆ†é¡**: æ¶µè“‹å“ç®¡æ•™å­¸é‡é»
- **1536ç¶­å‘é‡**: é«˜ç²¾åº¦èªç¾©è¡¨ç¤º

## ğŸ¤ è²¢ç»æŒ‡å—

1. Fork å°ˆæ¡ˆ
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤è®Šæ›´ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. é–‹å•Ÿ Pull Request

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Š - è©³è¦‹ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ“ è¯çµ¡è³‡è¨Š

- **å°ˆæ¡ˆç¶­è­·è€…**: ä»Šçš“å°ˆå®¶åœ˜éšŠ
- **æŠ€è¡“æ”¯æ´**: [æŠ€è¡“æ”¯æ´ä¿¡ç®±]
- **å°ˆæ¡ˆç¶²å€**: [å°ˆæ¡ˆGitHubé€£çµ]

## ğŸ“‹ APIåŠŸèƒ½ç¸½çµ

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
1. **PDFæ–‡ä»¶è™•ç†** (`/process-pdf`)
   - æ”¯æ´PDFæ–‡ä»¶ä¸Šå‚³å’Œå³æ™‚è™•ç†
   - è‡ªå‹•æå–æ–‡å­—å’Œåœ–ç‰‡
   - GPT-4oè¦–è¦ºåˆ†ææŠ€è¡“åœ–é¢
   - è‡ªå‹•å‘é‡åŒ–ä¸¦å„²å­˜åˆ°Qdrant

2. **æ™ºèƒ½å•ç­”** (`/query`, `/chat`)
   - Flowiseæ•´åˆçš„å°ˆç”¨æŸ¥è©¢API
   - æ”¯æ´æœƒè©±è¨˜æ†¶çš„èŠå¤©åŠŸèƒ½
   - RAGæª¢ç´¢å¢å¼·ç”Ÿæˆ
   - å¤šæ¨¡æ…‹å›æ‡‰ï¼ˆæ–‡å­—+åœ–ç‰‡URLï¼‰

3. **è¨˜æ†¶ç®¡ç†** (`/sessions/*`)
   - å¤šæœƒè©±è¨˜æ†¶è¿½è¹¤
   - ä¸Šä¸‹æ–‡å°è©±æ”¯æ´
   - Tokenä½¿ç”¨é‡çµ±è¨ˆ
   - æœƒè©±ç”Ÿå‘½é€±æœŸç®¡ç†

4. **é›†åˆç®¡ç†** (`/collections/*`)
   - å¤šå€‹Qdranté›†åˆæ”¯æ´
   - å‹•æ…‹é›†åˆå»ºç«‹å’Œåˆªé™¤
   - é›†åˆç‹€æ…‹æŸ¥è©¢

5. **ç³»çµ±ç›£æ§** (`/health`, `/`)
   - å³æ™‚å¥åº·æª¢æŸ¥
   - ç³»çµ±ç‹€æ…‹è¨ºæ–·
   - è³‡æºä½¿ç”¨çµ±è¨ˆ

### ğŸ”§ æŠ€è¡“ç‰¹è‰²
- **é«˜æ•ˆå‘é‡æª¢ç´¢**: åŸºæ–¼Qdrantçš„èªç¾©æœå°‹
- **å¤šæ¨¡æ…‹è™•ç†**: æ–‡å­—+åœ–ç‰‡çš„ç¶œåˆåˆ†æ
- **é›²ç«¯æ•´åˆ**: AWS S3åœ–ç‰‡å„²å­˜æœå‹™
- **è¨˜æ†¶åŠŸèƒ½**: æ™ºèƒ½æœƒè©±è¨˜æ†¶ç®¡ç†
- **ä¼æ¥­ç´š**: RESTful APIè¨­è¨ˆï¼Œæ”¯æ´ç¬¬ä¸‰æ–¹æ•´åˆ

### ğŸŒ éƒ¨ç½²è³‡è¨Š
- **æœå‹™ç«¯å£**: 8006
- **APIæ ¹è·¯å¾‘**: `/api/v1/JH`
- **æ–‡æª”åœ°å€**: `/docs` (Swagger UI)
- **å¥åº·æª¢æŸ¥**: `/health`

---

*æœ€å¾Œæ›´æ–°: 2025-07-04*
cd /home/chun/heph-dev/JH
uv run embedding2qdrant/batch_process_files.py "å°ˆå®¶/åœ–ç´™èªè­˜" --cost-per-file 0.05 --total-budget 0.5 --collection-name test0711

uv run embedding2qdrant/batch_process_files.py "å°ˆå®¶/åœ–ç´™èªè­˜" --collection-name "JH-åœ–ç´™èªè­˜-langchain"